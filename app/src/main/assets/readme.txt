For comments and explainations take a look at the vec4 version of the 
.cl kernel. 
