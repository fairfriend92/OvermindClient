For comments and explainations take a look at the vec4 versione of the 
.cl kernel. 
